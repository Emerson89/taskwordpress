---
# tasks file for php
- name: Instalando yum-utils/epel-release
  yum: name={{ item }} state=present
  with_items:
    - epel-release
    - yum-utils
  become: yes

- name: Baixando repositório remi-release-7
  get_url:
      url: http://rpms.remirepo.net/enterprise/remi-release-7.rpm
      dest: /tmp/remi-release-7.rpm
      mode: 0777
  become: yes

- name: Adicionando repositório remi-release-7
  yum: name=/tmp/remi-release-7.rpm state=present
  become: yes

- name: Habilitando remi-php73
  shell: yum-config-manager --enable remi-php73
  become: yes

- name: Atualizando repositório
  yum: name=* state=latest
  become: yes

- name: Instalando php73
  yum: name={{ item }} state=present
  with_items:
    - php
    - php-fpm
    - php-common 
    - php-opcache 
    - php-mcrypt 
    - php-cli 
    - php-gd 
    - php-curl 
    - php-mysqlnd
  become: yes

- name : Substituindo user www.conf
  shell: sed -i 's/user = apache/user = nginx/g' /etc/php-fpm.d/www.conf
  become: yes
  
- name: Substituindo group www.conf
  shell: sed -i 's/group = apache/group = nginx/g' /etc/php-fpm.d/www.conf
  become: yes
  
- name: Start e habilitando no boot php-fpm
  service: name=php-fpm state=started enabled=yes
  become: yes

  
